<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>게시판</title>

		<style>
			body {
				display: flex;
				flex-direction: column;
				align-items: center;
				height: 100vh;
				margin: 0;
			}

			.search-container {
				width: 90%;
				display: flex;
				align-items: left;
				margin-top: 10px;
			}

			.search-container select {
				width: 10%;
				margin-right: 1%;
				text-align: center;
			}

			.search-container input {
				width: 50%;
				margin-right: 5px;
				text-align: center;
			}

			.table-container {
				width: 90%;
				item-alignment: center;
			}

			table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 20px;
			}

			th,
			td {
				border: 1px solid #ddd;
				padding: 8px;
				text-align: center;
			}

			th:nth-child(1),
			td:nth-child(1) {
				width: 25%; /* 첫 번째 컬럼 너비 조절 */
			}

			th:nth-child(2),
			td:nth-child(2) {
				width: 5%; /* 두 번째 컬럼 너비 조절 */
			}

			th:nth-child(3),
			td:nth-child(3) {
				width: 10%; /* 세 번째 컬럼 너비 조절 */
			}

			th:nth-child(4),
			td:nth-child(4) {
				width: 15%; /* 네 번째 컬럼 너비 조절 */
			}

			th:nth-child(5),
			td:nth-child(5) {
				width: 15%; /* 다섯 번째 컬럼 너비 조절 */
			}

			th:nth-child(6),
			td:nth-child(6) {
				width: 30%; /* 여섯 번째 컬럼 너비 조절 */
			}

			th.button-column::before {
				content: "조작";
				display: block;
			}

			.button-column {
				width: 1%;
				white-space: nowrap;
				text-align: center;
			}

			.button-column button {
				margin-left: 5px;
			}

			td:last-child {
				text-align: center;
			}
		</style>
	</head>

	<body>
		<div class="row">
			<div class="col-md-8">
				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<button
							type="button"
							class="btn btn-default dropdown-toggle"
							data-toggle="dropdown"
						>
							<span id="selectedCondition">광고ID</span>
						</button>
						<div class="dropdown-menu" id="selectedCondition">
							<a
								class="dropdown-item"
								href="#"
								onclick="setSelectedCondition('ad_id')"
								>광고ID</a
							>
							<a
								class="dropdown-item"
								href="#"
								onclick="setSelectedCondition('product_name')"
								>상품ID</a
							>
						</div>
					</div>
					<input
						type="text"
						class="form-control"
						id="searchInput"
						placeholder="검색어를 입력하세요"
					/>
				</div>
			</div>
			<div class="col-md-3">
				<button
					type="button"
					class="btn btn-block btn-primary"
					onclick="searchAd()"
				>
					검색
				</button>
			</div>
		</div>

		<!-- .table-container 추가 -->
		<div class="table-container">
			<table
				id="boardTable"
				class="table table-bordered table-striped Datatable"
			>
				<thead>
					<tr>
						<th>광고 ID</th>
						<th>슬롯 ID</th>
						<th>컨텐츠 타입</th>
						<th>시작 날짜</th>
						<th>종료 날짜</th>
						<th class="button-column"></th>
					</tr>
				</thead>
				<tbody>
					<!-- 여기에 동적으로 내용이 추가될 예정 -->
				</tbody>
			</table>
		</div>

		<ul class="pagination" id="pagination"></ul>

		<script>
			// // 예시 JSON 데이터 (2개만 출력)
			// var jsonDataArray = [
			// 	'{"ad_id": 1, "slot_id": 1, "content_type": "영상", "start_date": "2024-01-16", "end_date": "2024-01-20"}',
			// 	'{"ad_id": 2, "slot_id": 2, "content_type": "이미지", "start_date": "2024-02-01", "end_date": "2024-02-10"}',
			// 	'{"ad_id": 3, "slot_id": 3, "content_type": "영상", "start_date": "2024-03-15", "end_date": "2024-03-20"}',
			// 	'{"ad_id": 4, "slot_id": 4, "content_type": "이미지", "start_date": "2024-04-05", "end_date": "2024-04-15"}',
			// 	'{"ad_id": 5, "slot_id": 5, "content_type": "영상", "start_date": "2024-05-10", "end_date": "2024-05-18"}',
			// 	'{"ad_id": 6, "slot_id": 6, "content_type": "이미지", "start_date": "2024-06-02", "end_date": "2024-06-10"}',
			// 	'{"ad_id": 7, "slot_id": 7, "content_type": "영상", "start_date": "2024-07-12", "end_date": "2024-07-20"}',
			// 	'{"ad_id": 8, "slot_id": 8, "content_type": "이미지", "start_date": "2024-08-01", "end_date": "2024-08-10"}',
			// 	'{"ad_id": 9, "slot_id": 9, "content_type": "영상", "start_date": "2024-09-05", "end_date": "2024-09-15"}',
			// 	'{"ad_id": 10, "slot_id": 10, "content_type": "이미지", "start_date": "2024-10-10", "end_date": "2024-10-18"}',
			// 	'{"ad_id": 11, "slot_id": 11, "content_type": "영상", "start_date": "2024-11-12", "end_date": "2024-11-20"}',
			// 	'{"ad_id": 12, "slot_id": 12, "content_type": "이미지", "start_date": "2024-12-01", "end_date": "2024-12-10"}',
			// 	'{"ad_id": 13, "slot_id": 13, "content_type": "영상", "start_date": "2025-01-05", "end_date": "2025-01-15"}',
			// 	'{"ad_id": 14, "slot_id": 14, "content_type": "이미지", "start_date": "2025-02-10", "end_date": "2025-02-18"}',
			// 	'{"ad_id": 15, "slot_id": 15, "content_type": "영상", "start_date": "2025-03-12", "end_date": "2025-03-20"}',
			// 	'{"ad_id": 16, "slot_id": 16, "content_type": "이미지", "start_date": "2025-04-01", "end_date": "2025-04-10"}',
			// 	'{"ad_id": 17, "slot_id": 17, "content_type": "영상", "start_date": "2025-05-05", "end_date": "2025-05-15"}',
			// 	'{"ad_id": 18, "slot_id": 18, "content_type": "이미지", "start_date": "2025-06-10", "end_date": "2025-06-18"}',
			// 	'{"ad_id": 19, "slot_id": 19, "content_type": "영상", "start_date": "2025-07-12", "end_date": "2025-07-20"}',
			// 	'{"ad_id": 20, "slot_id": 20, "content_type": "이미지", "start_date": "2025-08-01", "end_date": "2025-08-10"}',
			// 	'{"ad_id": 21, "slot_id": 21, "content_type": "영상", "start_date": "2025-09-05", "end_date": "2025-09-15"}',
			// 	'{"ad_id": 22, "slot_id": 22, "content_type": "이미지", "start_date": "2025-10-10", "end_date": "2025-10-18"}',
			// 	'{"ad_id": 23, "slot_id": 23, "content_type": "영상", "start_date": "2025-11-12", "end_date": "2025-11-20"}',
			// 	'{"ad_id": 24, "slot_id": 24, "content_type": "이미지", "start_date": "2025-12-01", "end_date": "2025-12-10"}',
			// 	'{"ad_id": 25, "slot_id": 25, "content_type": "영상", "start_date": "2026-01-05", "end_date": "2026-01-15"}',
			// ];

			var itemsPerPage = 10;
			var currentPage = 1;

			// 테이블에 내용 추가하는 함수
			function addRow(data) {
				var tableBody = document
					.getElementById("boardTable")
					.getElementsByTagName("tbody")[0];
				var newRow = tableBody.insertRow(tableBody.rows.length);

				for (var key in data) {
					if (data.hasOwnProperty(key)) {
						var cell = newRow.insertCell();
						cell.textContent = data[key];
					}
				}

				var buttonCell = newRow.insertCell();
				buttonCell.className = "button-column";

				var btnGroupContainer = document.createElement("div");
				btnGroupContainer.className =
					"row button-container justify-content-center";

				function createButton(text, className, clickHandler) {
					var button = document.createElement("button");
					button.type = "button";
					button.className = className;
					button.textContent = text;
					button.onclick = clickHandler;
					return button;
				}

				// 상세 버튼
				var detailButton = createButton(
					"상세",
					"btn btn-outline-primary",
					function () {
						var adId = data.ad_id;
						getDetailAd(adId);
					}
				);
				btnGroupContainer.appendChild(detailButton);

				// 수정 버튼
				var editButton = createButton(
					"수정",
					"btn btn-outline-primary",
					function () {
						alert("수정 버튼 클릭: " + data.ad_id);
					}
				);
				btnGroupContainer.appendChild(editButton);

				// 삭제 버튼
				var deleteButton = createButton(
					"삭제",
					"btn btn-outline-secondary",
					function () {
						alert("삭제 버튼 클릭: " + data.ad_id);
					}
				);
				btnGroupContainer.appendChild(deleteButton);

				// 부모 컨테이너에 추가
				buttonCell.appendChild(btnGroupContainer);
			}

			// 선택한 검색 유형을 저장할 변수
			var selectedCondition = "광고ID";

			// 검색 유형 설정 함수
			function setSelectedCondition(con) {
				selectedCondition = con;
				document.getElementById("selectedCondition").innerText = selectedCondition;
			}

			// 검색 함수
			async function searchAd() {
				var searchInput = document.getElementById("searchInput").value;
				/*
                console.log(
					"검색합니다! 검색타입: " + search + " 검색어: " + searchInput
				);
                */

				clearTable();
				clearPagination();

				try {
					//실제 서버 API 호출은 주석처리된 부분을 사용
					
								const response = await fetch(
									"http://127.0.0.1:8000/search_ad/",
									{
										method: "POST",
										headers: {
											"Content-Type": "application/json",
										},
										body: JSON.stringify({
											condition: selectedCondition,
											search_input: searchInput,
										}),
									}
								);
								const data = await response.json();
								console.log(data);
						                 
					// 예시 JSON 데이터 사용
					// const data = jsonDataArray.map((json) => {
					// 	try {
					// 		return JSON.parse(json);
					// 	} catch (error) {
					// 		console.error("Error parsing JSON:", error);
					// 		return null; // 오류가 발생한 경우 해당 데이터 무시
					// 	}
					// });

					if (data.length === 0) {
						var tableBody = document
							.getElementById("boardTable")
							.getElementsByTagName("tbody")[0];
						var newRow = tableBody.insertRow(tableBody.rows.length);
						var cell = newRow.insertCell(0);
						cell.colSpan = 6;
						cell.textContent = "검색 결과가 없습니다.";
					} else {
						data
							.slice(
								(currentPage - 1) * itemsPerPage,
								currentPage * itemsPerPage
							)
							.forEach((apiData) => {
								const jsonData = {
									ad_id: apiData.ad_id,
									slot_id: apiData.slot_id,
									content_type: apiData.content_type,
									start_date: apiData.start_date,
									end_date: apiData.end_date,
								};
								addRow(jsonData);
							});
						generatePagination();
					}
				} catch (error) {
					console.error("Error during search:", error);
				}
			}

			// 상세 정보 가져오기 함수
			async function getDetailAd(adId) {
				try {
					// 실제 서버 API 호출은 주석처리된 부분을 사용
					const response = await fetch('https://api.example.com/detail_ad', {
					    method: 'POST',
					    headers: {
					        'Content-Type': 'application/json',
					    },
					    body: JSON.stringify({
					        ad_id: adId,
					    }),
					});
					const detailData = await response.json();

					// 예시 JSON 데이터 사용
					// const detailData = {
					// 	advertiser_id: "abcd",
					// 	title: "조던",
					// 	target: "20대",
					// 	ad_url: "www.google.com",
					// 	link_url: "www.link.com",
					// 	slot_id: 1,
					// 	cost_type: "click",
					// 	end_date: "2022-02-27",
					// 	start_date: "2022-03-27",
					// };

					// 받아온 데이터를 출력
					alert(JSON.stringify(detailData));
				} catch (error) {
					console.error("Error during fetching detail:", error);
				}
			}

			// 테이블 비우는 함수
			function clearTable() {
				var tableBody = document
					.getElementById("boardTable")
					.getElementsByTagName("tbody")[0];
				tableBody.innerHTML = "";
			}

			// 페이지네이션 초기화 함수
			function clearPagination() {
				var pagination = document.getElementById("pagination");
				pagination.innerHTML = "";
			}

			// 페이지네이션 생성 함수
			function generatePagination() {
				var totalItems = jsonDataArray.length;
				var totalPages = Math.ceil(totalItems / itemsPerPage);

				var pagination = document.getElementById("pagination");

				for (var i = 1; i <= totalPages; i++) {
					var listItem = document.createElement("li");
					listItem.textContent = i;
					listItem.onclick = function () {
						currentPage = parseInt(this.textContent);
						searchAd();
					};
					pagination.appendChild(listItem);
				}
			}

			// 초기 데이터 로드
			searchAd();
		</script>
	</body>
</html>
